import{A as x,a as O,b as v,d as A}from"./CLLdnrBp.js";function D(e){return window.getComputedStyle(e).getPropertyValue("direction")}function $(e="ltr",t="horizontal"){return{horizontal:e==="rtl"?v:O,vertical:A}[t]}function E(e="ltr",t="horizontal"){return{horizontal:e==="rtl"?O:v,vertical:x}[t]}function I(e="ltr",t="horizontal"){return["ltr","rtl"].includes(e)||(e="ltr"),["horizontal","vertical"].includes(t)||(t="horizontal"),{nextKey:$(e,t),prevKey:E(e,t)}}function B(e){return e?`/auth/login/${e}`:"/auth/login"}var g="/",W=(e,t)=>(e.endsWith(g)&&(e=e.slice(0,-1)),t.startsWith(g)||(t=g+t),e+t),y=(e,t,r)=>{let a=e.pathname===g?t:W(e.pathname,t),s=new globalThis.URL(a,e);if(r)for(let[i,n]of Object.entries(U(r)))if(n&&typeof n=="object"&&!Array.isArray(n))for(let[o,h]of Object.entries(n))s.searchParams.set(`${i}[${o}]`,String(h));else s.searchParams.set(i,n);return s};function J(e){return typeof e!="object"||!e?!1:"headers"in e&&"ok"in e&&"json"in e&&typeof e.json=="function"&&"text"in e&&typeof e.json=="function"}async function N(e){if(!(typeof e!="object"||!e)){if(J(e)){let t=e.headers.get("Content-Type")?.toLowerCase();if(t?.startsWith("application/json")||t?.startsWith("application/health+json")){let r=await e.json();if(!e.ok||"errors"in r)throw r;return"data"in r?r.data:r}if(t?.startsWith("text/html")||t?.startsWith("text/plain")){let r=await e.text();if(!e.ok)throw r;return r}return e.status===204?null:e}if("errors"in e)throw e;return"data"in e?e.data:e}}var m=async(e,t,r=globalThis.fetch)=>(t.headers=typeof t.headers=="object"&&!Array.isArray(t.headers)?t.headers:{},r(e,t).then(a=>N(a).catch(s=>{let i={errors:s&&typeof s=="object"&&"errors"in s?s.errors:s,response:a};return s&&typeof s=="object"&&"data"in s&&(i.data=s.data),Promise.reject(i)}))),P=()=>{let e=null;return{get:async()=>e,set:async t=>{e=t}}},z={msRefreshBeforeExpires:3e4,autoRefresh:!0},G=2**31-1,F=(e="cookie",t={})=>r=>{let a={...z,...t},s=null,i=null,n=a.storage??P(),o=async()=>n.set({access_token:null,refresh_token:null,expires:null,expires_at:null}),h=async()=>{try{await s}finally{s=null}},b=async()=>{let l=await n.get();return s||!l?.expires_at||l.expires_at<new Date().getTime()+a.msRefreshBeforeExpires&&_().catch(c=>{}),h()},j=async l=>{let c=l.expires??0;l.expires_at=new Date().getTime()+c,await n.set(l),a.autoRefresh&&c>a.msRefreshBeforeExpires&&c<G&&(i&&clearTimeout(i),i=setTimeout(()=>{i=null,_().catch(u=>{})},c-a.msRefreshBeforeExpires))},_=async()=>(s=(async()=>{let l=await n.get();await o();let c={method:"POST",headers:{"Content-Type":"application/json"}};"credentials"in a&&(c.credentials=a.credentials);let u={mode:e};e==="json"&&l?.refresh_token&&(u.refresh_token=l.refresh_token),c.body=JSON.stringify(u);let f=y(r.url,"/auth/refresh");return m(f.toString(),c,r.globals.fetch).then(d=>j(d).then(()=>d))})(),s);return{refresh:_,async login(l,c,u={}){await o();let f={email:l,password:c};"otp"in u&&(f.otp=u.otp),f.mode=u.mode??e;let d=B(u.provider),C=y(r.url,d),S={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)};"credentials"in a&&(S.credentials=a.credentials);let R=await m(C.toString(),S,r.globals.fetch);return await j(R),R},async logout(){let l=await n.get(),c={method:"POST",headers:{"Content-Type":"application/json"}};"credentials"in a&&(c.credentials=a.credentials);let u={mode:e};e==="json"&&l?.refresh_token&&(u.refresh_token=l.refresh_token),c.body=JSON.stringify(u);let f=y(r.url,"/auth/logout");await m(f.toString(),c,r.globals.fetch),this.stopRefreshing(),await o()},stopRefreshing(){i&&clearTimeout(i)},async getToken(){return await b().catch(()=>{}),(await n.get())?.access_token??null},async setToken(l){return n.set({access_token:l,refresh_token:null,expires:null,expires_at:null})}}},k={fetch:globalThis.fetch,WebSocket:globalThis.WebSocket,URL:globalThis.URL,logger:globalThis.console},H=(e,t={})=>{let r=t.globals?{...k,...t.globals}:k;return{globals:r,url:new r.URL(e),with(a){return{...this,...a(this)}}}},M=(e,t)=>()=>({path:"/files",method:"POST",body:e,params:t??{},headers:{"Content-Type":"multipart/form-data"}});function w(e){return["directus_access","directus_activity","directus_collections","directus_comments","directus_fields","directus_files","directus_folders","directus_migrations","directus_permissions","directus_policies","directus_presets","directus_relations","directus_revisions","directus_roles","directus_sessions","directus_settings","directus_users","directus_webhooks","directus_dashboards","directus_panels","directus_notifications","directus_shares","directus_flows","directus_operations","directus_translations","directus_versions","directus_extensions"].includes(e)}var V=(e,t,r)=>()=>{let a=String(e);if(w(a))throw new Error("Cannot use createItem for core collections");return{path:`/items/${a}`,params:r??{},body:JSON.stringify(t),method:"POST"}},K=e=>{let t=(r,a=[])=>{if(typeof r=="object"){let s=[];for(let i in r){let n=r[i]??[];if(Array.isArray(n))for(let o of n)s.push(t(o,[...a,i]));else if(typeof n=="object")for(let o of Object.keys(n)){let h=n[o];for(let b of h)s.push(t(b,[...a,`${i}:${o}`]))}}return s.flatMap(i=>i)}return[...a,String(r)].join(".")};return e.flatMap(r=>t(r))},U=e=>{let t={};Array.isArray(e.fields)&&e.fields.length>0&&(t.fields=K(e.fields).join(",")),e.filter&&Object.keys(e.filter).length>0&&(t.filter=JSON.stringify(e.filter)),e.search&&(t.search=e.search),"sort"in e&&e.sort&&(t.sort=typeof e.sort=="string"?e.sort:e.sort.join(",")),typeof e.limit=="number"&&e.limit>=-1&&(t.limit=String(e.limit)),typeof e.offset=="number"&&e.offset>=0&&(t.offset=String(e.offset)),typeof e.page=="number"&&e.page>=1&&(t.page=String(e.page)),e.deep&&Object.keys(e.deep).length>0&&(t.deep=JSON.stringify(e.deep)),e.alias&&Object.keys(e.alias).length>0&&(t.alias=JSON.stringify(e.alias)),e.aggregate&&Object.keys(e.aggregate).length>0&&(t.aggregate=JSON.stringify(e.aggregate)),e.groupBy&&e.groupBy.length>0&&(t.groupBy=e.groupBy.join(","));for(let[r,a]of Object.entries(e))r in t||(typeof a=="string"||typeof a=="number"||typeof a=="boolean"?t[r]=String(a):t[r]=JSON.stringify(a));return t},p=(e,t)=>{if(e.length===0)throw new Error(t)},T=(e,t)=>{if(w(String(e)))throw new Error(t)},Q=(e,t)=>()=>{let r=String(e);return p(r,"Collection cannot be empty"),{path:w(r)?`/${r.substring(9)}`:`/items/${r}`,method:"GET",params:{...t.query??{},...t.groupBy?{groupBy:t.groupBy}:{},aggregate:t.aggregate}}},X=(e,t)=>()=>(p(String(e),"Collection cannot be empty"),T(e,"Cannot use readItems for core collections"),{path:`/items/${e}`,params:t??{},method:"GET"}),Y=(e,t,r)=>()=>(p(String(e),"Collection cannot be empty"),T(e,"Cannot use readItem for core collections"),p(String(t),"Key cannot be empty"),{path:`/items/${e}/${t}`,params:r??{},method:"GET"}),Z=(e,t)=>()=>(p(String(e),"Collection cannot be empty"),T(e,"Cannot use readSingleton for core collections"),{path:`/items/${e}`,params:t??{},method:"GET"}),ee=(e,t)=>()=>(p(String(e),"Key cannot be empty"),{path:`/users/${e}`,params:t??{},method:"GET"}),L={},te=(e={})=>t=>{let r={...L,...e};return{async request(a){let s=a();if(s.headers||(s.headers={}),"Content-Type"in s.headers?s.headers["Content-Type"]==="multipart/form-data"&&delete s.headers["Content-Type"]:s.headers["Content-Type"]="application/json","getToken"in this&&!("Authorization"in s.headers)){let h=await this.getToken();h&&(s.headers.Authorization=`Bearer ${h}`)}let i=y(t.url,s.path,s.params),n={method:s.method??"GET",headers:s.headers??{}};"credentials"in r&&(n.credentials=r.credentials),s.body&&(n.body=s.body),s.onRequest&&(n=await s.onRequest(n)),r.onRequest&&(n=await r.onRequest(n));let o=await m(i.toString(),n,t.globals.fetch);return"onResponse"in s&&(o=await s.onResponse(o,n)),"onResponse"in e&&(o=await e.onResponse(o,n)),o}}};function re(e,t){return()=>{let r=t();return e&&(r.headers||(r.headers={}),r.headers.Authorization=`Bearer ${e}`),r}}export{X as G,Z as J,Y as K,V as U,ee as _,I as a,M as b,D as g,te as j,H as l,F as n,Q as t,re as v};
